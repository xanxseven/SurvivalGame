(()=>{"use strict";var t,e=0,i=e++,n=e++,r=e++,a=0,o=1,s=2,h=3,c=4,u=5,f=6,l=7,d=8,p=9,m=10,v=11,y=0,w=1,g=2,b=3,k=0,x=1,A=3,S=4,U=5,P=6,T=7,E=8,I=9,L=10,M=11,O=12,R=13;function B(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var F=0,D=1,H=2,z=5,j=6,_=7,W=(B(t={},F,1),B(t,H,.2),B(t,_,.2),t),C=0,K=1,N=[];function X(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function q(t,e,i){return e&&Y(t.prototype,e),i&&Y(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}N[C]={id:C,spriteId:-1,useDelay:100,useCooldown:200,inventorySprite:k,isMeele:!0,meeleRange:100,meeleDamage:30,anim:{idle:F,move:D,use:H}},N[K]={id:K,spriteId:U,inventorySprite:M,useDelay:100,useCooldown:200,isMeele:!0,meeleRange:100,meeleDamage:30,anim:{idle:z,move:j,use:_}};var G=function(){function t(){X(this,t),B(this,"array",[]),B(this,"map",new Map),B(this,"unused_ids",[]),B(this,"id_cursor",0)}return q(t,[{key:"has",value:function(t){return this.map.has(t)}},{key:"insert",value:function(t){var e=this.array.length;this.array.push(t),this.map.set(t.id,e)}},{key:"remove",value:function(t){var e=this.map.get(t.id),i=this.array.length-1;if(i!==e){var n=this.array[i];this.array[i]=t,this.array[e]=n,this.map.set(n.id,e)}this.array.pop(),this.map.delete(t.id),this.unused_ids.push(t.id),t.id=-1}},{key:"deleteId",value:function(t){var e=this.find(t);this.remove(e)}},{key:"find",value:function(t){var e=this.map.get(t);return this.array[e]}}]),t}(),J=0,Q=0,V=0,Z=0,$=0;function tt(){return Q=J,J}function et(){var t=Date.now(),e=(J!==Q||V!==Z)&&t-$>1e3/15;return e&&($=t),e}window.addEventListener("keydown",(function(t){switch(t.code){case"KeyW":J|=1;break;case"KeyD":J|=2;break;case"KeyS":J|=4;break;case"KeyA":J|=8}})),window.addEventListener("keyup",(function(t){switch(t.code){case"KeyW":J&=-2;break;case"KeyD":J&=-3;break;case"KeyS":J&=-5;break;case"KeyA":J&=-9}})),window.addEventListener("mousemove",(function(t){Z=Math.atan2(t.y-.5*window.innerHeight,t.x-.5*window.innerWidth)-.5*Math.PI})),window.addEventListener("mousedown",(function(t){Z=Math.atan2(t.y-.5*window.innerHeight,t.x-.5*window.innerWidth)-.5*Math.PI,Et.writeU8(g),Et.writeF32(Z),Ot()})),window.addEventListener("mouseup",(function(t){Z=Math.atan2(t.y-.5*window.innerHeight,t.x-.5*window.innerWidth)-.5*Math.PI,Et.writeU8(b),Ot()}));var it=[];function nt(t,e,i,n){var r=it.length?it.pop():[0,0,0,0];return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}var rt,at=function(){function t(e){X(this,t),B(this,"id",-1),B(this,"type",0),B(this,"buffer",[]),B(this,"delta",0),B(this,"animationState",F),B(this,"totalTransitionTime",1),B(this,"transition",0),B(this,"isTransition",!1),B(this,"root",null),B(this,"doInterpolation",!1),B(this,"doUpdate",!1),this.type=e}return q(t,[{key:"changeAnimState",value:function(t){this.animationState=t,this.delta=0,this.transition=0,this.isTransition=!0}},{key:"setTransform",value:function(t,e,i){this.root.position.x=t,this.root.position.y=e,this.root.rotation=i}},{key:"setRotation",value:function(t){this.root.rotation=t}},{key:"updateHealth",value:function(t){}},{key:"addToScene",value:function(){Hi.add(this.root)}},{key:"removeFromScene",value:function(){Hi.remove(this.root)}},{key:"update",value:function(t){}},{key:"onAnimationOver",value:function(){}}]),t}();function ot(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function st(t,e){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},st(t,e)}function ht(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&st(t,e)}function ct(t){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(t)}function ut(t,e){if(e&&("object"===ct(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ot(t)}function ft(t){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ft(t)}function lt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=ft(t);if(e){var r=ft(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return ut(this,i)}}!function(t){t[t.NODE=0]="NODE",t[t.SCENE=1]="SCENE",t[t.SPRITE=2]="SPRITE"}(rt||(rt={}));var dt,pt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;X(this,t),this.x=e,this.y=i}return q(t,[{key:"copy",value:function(t){this.x=t.x,this.y=t.y}}]),t}(),mt=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Image;X(this,t),this.src=e,this.texture=n,this.srcWidth=i.x,this.srcHeight=i.y,this.texture instanceof HTMLImageElement&&(this.texture.src=e)}return q(t,[{key:"frame",value:function(t,e,i,n){return new vt(this,t,e,i,n)}}]),t}(),vt=q((function t(e,i,n,r,a){X(this,t),B(this,"anchor",new pt),B(this,"uvs",[0,0,0,0]),B(this,"size",new pt),B(this,"scale",new pt),this.scale.copy(a),this.size.copy(n),this.anchor.copy(r),this.texture=e,this.tex=e.texture,this.uvs[0]=i.x/e.srcWidth,this.uvs[1]=i.y/e.srcHeight,this.uvs[2]=n.x/e.srcWidth,this.uvs[3]=n.y/e.srcHeight})),yt=function(){function t(){X(this,t),B(this,"parent",null),B(this,"children",[]),B(this,"depth",0),B(this,"isSprite",!1),B(this,"position",new pt(0,0)),B(this,"rotation",0),B(this,"scale",new pt(1,1)),B(this,"pivot",new pt(0,0)),B(this,"visible",!0),B(this,"dirty",!1)}return q(t,[{key:"sort",value:function(){for(var t=this.children.length,e=1;e<t;e++){for(var i=this.children[e],n=e-1;n>-1&&i.depth<this.children[n].depth;)this.children[n+1]=this.children[n],n--;this.children[n+1]=i}this.dirty=!1}},{key:"add",value:function(t){this.dirty=!0,t.parent=this,this.children.push(t)}},{key:"remove",value:function(t){t.parent===this&&(t.parent=null,this.children.splice(this.children.indexOf(t),1))}},{key:"setDepth",value:function(t){this.parent&&(this.parent.dirty=!0),this.depth=t}}]),t}(),wt=function(t){ht(i,t);var e=lt(i);function i(t){var n;return X(this,i),B(ot(n=e.call(this)),"isSprite",!0),n.frame=t,n}return q(i)}(yt),gt=function(t){ht(i,t);var e=lt(i);function i(t,n){var r;X(this,i);var a=document.createElement("canvas"),o=new mt("",new pt(1,1),a).frame(new pt,new pt(1,1),new pt,new pt(1,1));return(r=e.call(this,o)).options=Object.assign({},n),r.canvas=a,r.ctx=r.canvas.getContext("2d"),r.updateText(t),r}return q(i,[{key:"updateText",value:function(t){var e=this.ctx,i=this.canvas,n=this.frame,r=this.options.fontSize,a=this.options.fontFamily,o="".concat(r,"px ").concat(a);e.font=o;var s=e.measureText(t).width,h=r;i.width=s,i.height=h,e.textBaseline=this.options.baseLine,e.fillStyle=this.options.fill,e.font=o,e.textAlign=this.options.align;var c="right"===this.options.align?s:0;e.fillText(t,c,0),n.size.x=s,n.size.y=h,n.texture.srcWidth=s,n.texture.srcHeight=h}}]),i}(wt),bt=function(t){ht(i,t);var e=lt(i);function i(){var t;X(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return B(ot(t=e.call.apply(e,[this].concat(r))),"lastState",[0,0,0,0,0]),t}return q(i,[{key:"saveState",value:function(){this.lastState[0]=this.position.x,this.lastState[1]=this.position.y,this.lastState[2]=this.rotation,this.lastState[3]=this.scale.x,this.lastState[4]=this.scale.y}}]),i}(wt),kt=function(){function t(e){X(this,t),B(this,"width",1920),B(this,"height",1080),B(this,"scale",1),B(this,"invScale",1),B(this,"scaledWidth",1920),B(this,"scaledHeight",1080),this.canvas=e,this.ctx=this.canvas.getContext("2d")}return q(t,[{key:"clearScreen",value:function(t){this.ctx.fillStyle=t,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillRect(0,0,this.width,this.height)}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,this.scale=Math.max(t/1920,e/1080),this.invScale=1/this.scale,this.scaledWidth=t*this.invScale,this.scaledHeight=e*this.invScale}},{key:"render",value:function(t){this.ctx.setTransform(this.scale,0,0,this.scale,0,0),this._render(t)}},{key:"_render",value:function(t){t.dirty&&t.sort();var e=this.ctx;if(e.save(),e.translate(t.position.x,t.position.y),e.rotate(t.rotation),e.scale(t.scale.x,t.scale.y),e.translate(-t.pivot.x,-t.pivot.y),t.isSprite){var i=t,n=i.frame.uvs,r=i.frame.size,a=i.frame.scale,o=i.frame.anchor;e.drawImage(i.frame.tex,r.x*n[0],r.y*n[1],r.x*n[2],r.y*n[3],-o.x*a.x,-o.y*a.y,r.x*a.x,r.y*a.y)}for(var s=t.children,h=0;h<s.length;h++){var c=s[h];c.visible&&this._render(c)}e.restore()}}]),t}(),xt=new Float32Array(1),At=new Uint8Array(xt.buffer),St=new TextDecoder,Ut=new TextEncoder,Pt=function(){function t(){X(this,t),B(this,"_buffer",new ArrayBuffer(65535)),B(this,"buffer",new Uint8Array(this._buffer)),B(this,"ptr",0)}return q(t,[{key:"bytes",value:function(){return new Uint8Array(this._buffer,0,this.ptr).slice()}},{key:"reset",value:function(){return this.ptr=0,this}},{key:"size",value:function(){return this.ptr}},{key:"writeU8",value:function(t){if(t<0||t>255||t!==Math.floor(t))throw new Error("out of range 0-255 provided:"+t);this.buffer[this.ptr++]=255&t}},{key:"writeString",value:function(t){var e=255&t.length;this.buffer[this.ptr++]=e;for(var i=0;i<e;i++)this.buffer[this.ptr++]=t.charCodeAt(i)}},{key:"writeUtf16",value:function(t){var e=Ut.encode(t),i=255&e.length;this.buffer[this.ptr++]=i;for(var n=0;n<i;n++)this.buffer[this.ptr++]=e[n]}},{key:"writeU16",value:function(t){if(t<0||t>65535||t!==Math.floor(t))throw new Error("out of range 0-35565 provided:"+t);this.buffer[this.ptr++]=255&t,this.buffer[this.ptr++]=t>>8&255}},{key:"writeI32",value:function(t){if(t<0||t>4294967295||t!==Math.floor(t))throw new Error("out of range 0-4294967295 provided:"+t);this.buffer[this.ptr++]=255&t,this.buffer[this.ptr++]=t>>8&255,this.buffer[this.ptr++]=t>>16&255,this.buffer[this.ptr++]=t>>24&255}},{key:"writeF32",value:function(t){xt[0]=t,this.buffer[this.ptr++]=At[0],this.buffer[this.ptr++]=At[1],this.buffer[this.ptr++]=At[2],this.buffer[this.ptr++]=At[3]}},{key:"writeLEB128",value:function(t){if(t<0||t!==Math.floor(t))throw new Error("out of range 0-4294967295 provided:"+t);do{var e=127&t;0!==(t>>>=7)&&(e|=128),this.buffer[this.ptr++]=255&e}while(0!==t)}}]),t}(),Tt=function(){function t(){X(this,t),B(this,"rPtr",0)}return q(t,[{key:"readFrom",value:function(t){this.rPtr=0,this.rU8=new Uint8Array(t)}},{key:"hasMoreData",value:function(){return this.rPtr<this.rU8.byteLength}},{key:"showPtr",value:function(){console.log(this.rU8,this.rPtr)}},{key:"readU8",value:function(){return this.rU8[this.rPtr++]}},{key:"readU16",value:function(){return this.rU8[this.rPtr++]|this.rU8[this.rPtr++]<<8}},{key:"readI32",value:function(){return this.rU8[this.rPtr++]|this.rU8[this.rPtr++]<<8|this.rU8[this.rPtr++]<<16|this.rU8[this.rPtr++]<<24}},{key:"readF32",value:function(){return At[0]=this.rU8[this.rPtr++],At[1]=this.rU8[this.rPtr++],At[2]=this.rU8[this.rPtr++],At[3]=this.rU8[this.rPtr++],xt[0]}},{key:"readULEB128",value:function(){for(var t=0,e=0,i=0;t|=(127&(i=this.rU8[this.rPtr++]))<<e,0!=(128&i);)e+=7;return t}},{key:"readString",value:function(){for(var t="",e=this.rU8[this.rPtr++],i=0;i<e;i++)t+=String.fromCharCode(this.rU8[this.rPtr++]);return t}},{key:"readUtf16",value:function(){for(var t=this.rU8[this.rPtr++],e=new Uint8Array(t),i=0;i<t;i++)e[i]=this.rU8[this.rPtr++];return St.decode(e)}},{key:"skipPacket",value:function(){this.rPtr=this.rU8.length}}]),t}(),Et=new Pt,It=new Tt,Lt=new WebSocket("ws://localhost:8080");function Mt(){Et.writeU8(y),Ot()}function Ot(){Lt.readyState===Lt.OPEN&&(Lt.send(Et.bytes()),Et.reset())}Lt.binaryType="arraybuffer",Lt.onopen=function(){console.log("Websocket connection opened!"),setTimeout((function(){Mt()}))},Lt.onclose=function(){console.log("Websocket disconencted!")},Lt.onmessage=function(t){var e,i,n,r,y,w=Date.now();for(It.readFrom(t.data);It.hasMoreData();){var g=It.readU8();switch(g){case a:Vi();break;case c:Gi();break;case o:Qi();break;case h:Ji();break;case u:qi(w);break;case f:Zi();break;case s:e=w,i=void 0,n=void 0,r=void 0,y=void 0,void 0,i=It.readULEB128(),n=It.readF32(),r=It.readF32(),y=It.readF32(),Wi.find(i).buffer.push(nt(e,r,y,n));break;case l:$i();break;case d:tn();break;case m:en();break;case v:nn();break;case p:Mt();break;default:throw"u "+g}}};var Rt,Bt=new mt("img/entity/tree.png",new pt(1397,1352)),Ft=new mt("img/entity/body2.png",new pt(200,163)),Dt=new mt("img/entity/arml2.png",new pt(68,78)),Ht=new mt("img/entity/armr2.png",new pt(68,77)),zt=new mt("img/item/wood_sword.png",new pt(307,112)),jt=new mt("img/ui/health-gauge-front.png",new pt(293,60)),_t=new mt("img/ui/health-gauge-background-object.png",new pt(293,60)),Wt=new mt("img/ui/health-gauge-background.png",new pt(293,60)),Ct=new mt("img/ui/leaderboard.png",new pt(500,660)),Kt=new mt("img/ui/slot.png",new pt(159,179)),Nt=new mt("img/entity/stone1.png",new pt(789,747)),Xt=new pt(.5,.5),Yt=new pt(0,0),qt=(B(dt={},O,Bt.frame(Yt,new pt(1396,1352),new pt(698,676),Xt)),B(dt,I,Bt.frame(Yt,new pt(1396,1352),new pt(698,676),new pt(.1,.1))),B(dt,x,Ft.frame(Yt,new pt(200,163),new pt(100,81.5),Xt)),B(dt,A,Ht.frame(Yt,new pt(68,78),new pt(34,39),Xt)),B(dt,S,Dt.frame(Yt,new pt(68,77),new pt(34,38.5),Xt)),B(dt,U,zt.frame(Yt,new pt(307,112),new pt(307*.2,56),Xt)),B(dt,T,jt.frame(Yt,new pt(293,60),new pt(146.5,30),Xt)),B(dt,E,_t.frame(Yt,new pt(293,60),new pt(0,30),Xt)),B(dt,P,Wt.frame(Yt,new pt(293,60),new pt(146.5,30),Xt)),B(dt,L,Ct.frame(Yt,new pt(500,660),new pt(0,0),Xt)),B(dt,M,Kt.frame(Yt,new pt(159,179),new pt(0,0),Xt)),B(dt,R,Nt.frame(Yt,new pt(789,747),new pt(394.5,373.5),Xt)),dt),Gt=2*Math.PI;function Jt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ft(t)););return t}function Qt(){return Qt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=Jt(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}},Qt.apply(this,arguments)}function Vt(){return new Array(23).fill(0)}var Zt=0,$t=1,te=3,ee=4,ie=5,ne=6,re=7,ae=8,oe=9,se=11,he=12,ce=13,ue=Zt,fe=$t,le=2,de=te,pe=ee,me=ie,ve=ne,ye=re,we=ae,ge=oe,be=10,ke=se,xe=he,Ae=ce,Se=14,Ue=15,Pe=16,Te=17,Ee=18,Ie=19,Le=20,Me=21,Oe=22,Re=2,Be=3,Fe=4,De=5,He=6,ze=7,je=8,_e=9,We=10,Ce=11,Ke=12,Ne=(B(Rt={},1,(function(t){return t*t})),B(Rt,Re,(function(t){return t*(2-t)})),B(Rt,Be,(function(t){return t<.5?2*t*t:(4-2*t)*t-1})),B(Rt,Fe,(function(t){return t*t*t})),B(Rt,De,(function(t){return--t*t*t+1})),B(Rt,He,(function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1})),B(Rt,ze,(function(t){return t*t*t*t})),B(Rt,je,(function(t){return 1- --t*t*t*t})),B(Rt,_e,(function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t})),B(Rt,We,(function(t){return t*t*t*t*t})),B(Rt,Ce,(function(t){return 1+--t*t*t*t*t})),B(Rt,Ke,(function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t})),Rt),Xe=new Float32Array([0,0,0,0,0]);function Ye(t,e){if(Xe[0]=t[ue],0!==t[me]){var i=e%t[me]/t[me];Math.floor(e/t[me])%2==1&&(i=1-i),t[ve]&&(i=Ne[t[ve]](i)),Xe[0]+=t[de]+i*(t[pe]-t[de])}if(Xe[1]=t[fe],0!==t[ge]){var n=e%t[ge]/t[ge];Math.floor(e/t[ge])%2==1&&(n=1-n),t[be]&&(n=Ne[t[be]](n)),Xe[1]+=t[ye]+n*(t[we]-t[ye])}if(Xe[2]=t[le],0!==t[Ae]){var r=e%t[Ae]/t[Ae];Math.floor(e/t[Ae])%2==1&&(r=1-r),t[Se]&&(r=Ne[t[Se]](r)),Xe[2]+=t[ke]+r*(t[xe]-t[ke])}if(0!==t[Te]){var a=e%t[Te]/t[Te];Math.floor(e/t[Te])%2==1&&(a=1-a),t[Ee]&&(a=Ne[t[Ee]](a)),Xe[3]=t[Ue]+a*(t[Pe]-t[Ue])}if(0!==t[Me]){var o=e%t[Me]/t[Me];Math.floor(e/t[Me])%2==1&&(o=1-o),t[Oe]&&(o=Ne[t[Oe]](o)),Xe[4]=t[Ie]+o*(t[Le]-t[Ie])}}function qe(t,e,i){Ye(e,i),t.position.x=Xe[0],t.position.y=Xe[1],t.rotation=Xe[2],e[Te]?t.scale.x=Xe[3]:t.scale.x=1,e[Me]?t.scale.y=Xe[4]:t.scale.y=1}var Ge=2*Math.PI,Je=Math.PI,Qe=(Math.PI,function(t,e){return function(t,e,i){return Math.min(Math.max(t,e),i)}(t-Math.floor(t/e)*e,0,e)});function Ve(t,e,i,n){Ye(e,i),t.position.x=(1-n)*t.lastState[0]+n*Xe[0],t.position.y=(1-n)*t.lastState[1]+n*Xe[1],t.rotation=function(t,e,i){var n,r=Qe(e-t,Ge);return(1-(n=i))*t+n*(t+(r>Je?r-Ge:r))}(t.lastState[2],Xe[2],n),Xe[3]?t.scale.x=(1-n)*t.lastState[3]+n*Xe[3]:t.scale.x=1,Xe[4]?t.scale.y=(1-n)*t.lastState[4]+n*Xe[4]:t.scale.y=1}var Ze=Vt();Ze[Zt]=40,Ze[$t]=30,Ze[se]=Ze[he]=.3,Ze[ce]=1,Ze[te]=25,Ze[ee]=30,Ze[ie]=1,Ze[re]=2,Ze[ae]=0,Ze[oe]=1;var $e=Vt();$e[Zt]=-40,$e[$t]=30,$e[se]=$e[he]=-.3,$e[ce]=1,$e[te]=-25,$e[ee]=-30,$e[ie]=1,$e[re]=2,$e[ae]=0,$e[oe]=1;var ti=Vt();ti[Zt]=40,ti[$t]=30,ti[se]=ti[he]=.3,ti[ce]=.5,ti[te]=25,ti[ee]=29,ti[ie]=.5,ti[re]=10,ti[ae]=2,ti[oe]=.5;var ei=Vt();ei[Zt]=-40,ei[$t]=30,ei[se]=ei[he]=-.3,ei[ce]=.5,ei[te]=-25,ei[ee]=-29,ei[ie]=.5,ei[re]=2,ei[ae]=10,ei[oe]=.5;var ii=Vt();ii[Zt]=-40,ii[$t]=30,ii[se]=-.3,ii[he]=-.8,ii[ce]=.2,ii[te]=-25,ii[ee]=20,ii[ie]=.2,ii[ne]=Fe,ii[re]=2,ii[ae]=40,ii[oe]=.2;var ni=Vt();ni[Zt]=40,ni[$t]=30,ni[se]=.3,ni[he]=.8,ni[ce]=.2,ni[te]=25,ni[ee]=-20,ni[ne]=Fe,ni[ie]=.2,ni[re]=2,ni[ae]=40,ni[oe]=.2;var ri=Vt();ri[se]=.8,ri[he]=.8,ri[ce]=1;var ai=function(){function t(){X(this,t),B(this,"backgroundColor",new wt(qt[P])),B(this,"border",new wt(qt[T])),B(this,"color",new wt(qt[E])),B(this,"root",new yt),this.root.add(this.backgroundColor),this.root.add(this.color),this.root.add(this.border),this.color.position.x=-this.backgroundColor.frame.anchor.x*this.backgroundColor.frame.scale.x+5}return q(t,[{key:"setHealth",value:function(t){this.color.scale.x=t}}]),t}();function oi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=ft(t);if(e){var r=ft(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return ut(this,i)}}var si=function(t){ht(i,t);var e=oi(i);function i(t){var n;return X(this,i),B(ot(n=e.call(this,t)),"itemId",C),B(ot(n),"root",new bt(qt[x])),B(ot(n),"leftArm",new bt(qt[A])),B(ot(n),"rightArm",new bt(qt[S])),B(ot(n),"item",new bt(qt[U])),B(ot(n),"spinner",new bt(qt[I])),B(ot(n),"nameLabel",new gt("Hello world!",{align:"left",baseLine:"top",fill:"black",fontFamily:"Ariel",fontSize:30})),B(ot(n),"healthBar",new ai),B(ot(n),"doInterpolation",!0),B(ot(n),"doUpdate",!0),B(ot(n),"activeArm",0),n.root.add(n.item),n.root.add(n.leftArm),n.root.add(n.rightArm),n.root.add(n.spinner),n.spinner.position.y=-60,n.animationState=F,n.item.setDepth(-1),n.setItemActive(!1),n.updateName("playerName"),n}return q(i,[{key:"updateName",value:function(t){this.nameLabel.updateText(t),this.nameLabel.frame.anchor.x=.5*this.nameLabel.frame.size.x,this.nameLabel.frame.anchor.y=.5*this.nameLabel.frame.size.y}},{key:"updateHealth",value:function(t){this.healthBar.setHealth(t/100)}},{key:"setTransform",value:function(t,e,i){this.root.position.x=t,this.root.position.y=e,this.root.rotation=i,this.healthBar.root.position.x=t,this.healthBar.root.position.y=e+130,this.nameLabel.position.x=t,this.nameLabel.position.y=e-130}},{key:"changeAnimState",value:function(t){t===H&&(this.activeArm=+!this.activeArm),Qt(ft(i.prototype),"changeAnimState",this).call(this,t)}},{key:"addToScene",value:function(){Hi.add(this.root),zi.add(this.healthBar.root),zi.add(this.nameLabel)}},{key:"removeFromScene",value:function(){Hi.remove(this.root),zi.remove(this.healthBar.root),zi.remove(this.nameLabel)}},{key:"onAnimationOver",value:function(){this.animationState===H?this.changeAnimState(F):this.animationState===_&&this.changeAnimState(z)}},{key:"update",value:function(t){if(this.delta+=t,this.spinner.rotation+=t,this.isTransition&&(this.transition+=t,this.transition>this.totalTransitionTime&&(this.isTransition=!1)),this.isTransition){var e=this.transition/this.totalTransitionTime;switch(this.animationState){case F:Ve(this.rightArm,Ze,this.delta,e),Ve(this.leftArm,$e,this.delta,e);break;case H:this.activeArm?(Ve(this.rightArm,Ze,this.delta,e),Ve(this.leftArm,ii,this.delta,e)):(Ve(this.rightArm,ni,this.delta,e),Ve(this.leftArm,$e,this.delta,e));break;case D:Ve(this.rightArm,ti,this.delta,e),Ve(this.leftArm,ei,this.delta,e);break;case z:Ve(this.rightArm,Ze,this.delta,e),Ve(this.leftArm,$e,this.delta,e),Ve(this.item,ri,this.delta,e),this.item.position.x=this.leftArm.position.x,this.item.position.y=this.leftArm.position.y;break;case j:Ve(this.rightArm,ti,this.delta,e),Ve(this.leftArm,ei,this.delta,e),Ve(this.item,ri,this.delta,e),this.item.position.x=this.leftArm.position.x,this.item.position.y=this.leftArm.position.y;break;case _:Ve(this.rightArm,ni,this.delta,e),Ve(this.leftArm,ii,this.delta,e),Ve(this.item,ri,this.delta,e),this.item.position.x=this.leftArm.position.x,this.item.position.y=this.leftArm.position.y}}else switch(this.animationState){case F:qe(this.leftArm,$e,this.delta),qe(this.rightArm,Ze,this.delta);break;case D:qe(this.rightArm,ti,this.delta),qe(this.leftArm,ei,this.delta);break;case H:this.activeArm?(qe(this.rightArm,Ze,this.delta),qe(this.leftArm,ii,this.delta)):(qe(this.rightArm,ni,this.delta),qe(this.leftArm,$e,this.delta));break;case z:qe(this.rightArm,Ze,this.delta),qe(this.leftArm,$e,this.delta),qe(this.item,ri,this.delta),this.item.position.x=this.leftArm.position.x,this.item.position.y=this.leftArm.position.y;break;case j:qe(this.rightArm,ti,this.delta),qe(this.leftArm,ei,this.delta),qe(this.item,ri,this.delta),this.item.position.x=this.leftArm.position.x,this.item.position.y=this.leftArm.position.y;break;case _:qe(this.rightArm,ni,this.delta),qe(this.leftArm,ii,this.delta),qe(this.item,ri,this.delta),this.item.position.x=this.leftArm.position.x,this.item.position.y=this.leftArm.position.y}this.leftArm.saveState(),this.rightArm.saveState(),this.item.saveState(),this.root.saveState(),this.delta>2*W[this.animationState]&&this.onAnimationOver()}},{key:"setRotation",value:function(t){this.root.rotation=t}},{key:"setItemActive",value:function(t){this.item.visible=t}},{key:"setItemOnTop",value:function(){this.item.setDepth(1)}},{key:"setItemOnBottom",value:function(){this.item.setDepth(-1)}},{key:"changeItem",value:function(t){var e=N[t].spriteId;-1===e?this.item.visible=!1:(this.item.frame=qt[e],this.item.visible=!0)}}]),i}(at);function hi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=ft(t);if(e){var r=ft(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return ut(this,i)}}var ci=function(t){ht(i,t);var e=hi(i);function i(){var t;X(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return B(ot(t=e.call.apply(e,[this].concat(r))),"root",new yt),B(ot(t),"sprite",null),B(ot(t),"hitX",0),B(ot(t),"hitY",0),B(ot(t),"hitAnimtionTime",.2),B(ot(t),"hitTimer",t.hitAnimtionTime),B(ot(t),"hit",!1),t}return q(i,[{key:"setHit",value:function(t,e){this.hitX=t,this.hitY=e,this.hit=!0,this.doUpdate=!0}},{key:"update",value:function(t){if(this.hit)if(this.hitTimer-=t,this.hitTimer<=0)this.sprite.position.x=0,this.sprite.position.y=0,this.hitTimer=this.hitAnimtionTime,this.hit=!1,this.doUpdate=!1;else{var e=1-this.hitTimer/this.hitAnimtionTime,i=e>.5?1-e:e;this.sprite.position.x=-this.hitX*i,this.sprite.position.y=-this.hitY*i}}}]),i}(at),ui=function(t){ht(i,t);var e=hi(i);function i(t){var n;return X(this,i),(n=e.call(this,t)).sprite=new wt(qt[O]),n.root.add(n.sprite),n}return q(i)}(ci),fi=new yt,li=new wt(qt[L]),di=[],pi=[],mi=[];fi.add(li);for(var vi="Baloo Paaji",yi=0;yi<10;yi++){var wi=new gt(yi+".",{fontFamily:vi,fontSize:25,align:"left",baseLine:"top",fill:"white"}),gi=new gt("rank"+yi,{fontFamily:vi,fontSize:25,align:"left",baseLine:"top",fill:"white"}),bi=new gt("123k",{fontFamily:vi,fontSize:25,align:"right",baseLine:"top",fill:"white"});wi.position.x=10,wi.position.y=60+27*yi,gi.position.x=45,gi.position.y=60+27*yi,bi.position.x=190,bi.position.y=60+27*yi,di.push(gi),pi.push(wi),mi.push(bi),fi.add(wi),fi.add(gi),fi.add(bi)}for(var ki=fi,xi=function(){fi.position.x=Mi.width*Mi.invScale-li.frame.size.x*li.frame.scale.x-5},Ai=new yt,Si=[],Ui=0;Ui<10;Ui++){var Pi=new wt(qt[M]);Si.push(Pi),Ai.add(Pi)}var Ti=Ai,Ei=function(){var t=Si[0],e=10*(t.frame.size.x*t.frame.scale.x+10),i=Mi.scaledHeight-t.frame.size.y*t.frame.scale.y-5,n=.5*Mi.scaledWidth-.5*e;Ai.position.y=i;for(var r=0;r<10;r++){var a=Si[r];a.position.y=0,a.position.x=n+r*(a.frame.size.x*a.frame.scale.x+10)}};function Ii(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=ft(t);if(e){var r=ft(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return ut(this,i)}}var Li=function(t){ht(i,t);var e=Ii(i);function i(t){var n;return X(this,i),(n=e.call(this,t)).sprite=new wt(qt[R]),n.root.add(n.sprite),n}return q(i)}(ci),Mi=new kt(document.getElementById("canvas")),Oi=new Map,Ri=new yt,Bi=new yt;Ri.add(Bi);var Fi=new yt,Di=new yt,Hi=new yt,zi=new yt;Di.add(Hi),Di.add(zi);var ji=new yt,_i=new yt,Wi=new G,Ci=-1,Ki=0;function Ni(){Mi.resize(window.innerWidth,window.innerHeight),Xi()}function Xi(){xi(),Ei()}function Yi(t,e){if(et()){var n=tt(),r=(V=Z,Z);Et.writeU8(w),Et.writeU8(n),Et.writeF32(r),Ot()}for(var a,o,s,h,c=Wi.array,u=t-1e3/Ki,f=0;f<c.length;f++){var l=c[f];if(l.doInterpolation){for(var d=l.buffer;d.length>=2&&d[1][0]<=u;)h=d.shift(),it.push(h);if(d.length>=2&&d[0][0]<=u&&u<=d[1][0]){var p=d[0][0],m=(u-p)/(d[1][0]-p),v=l.root,y=d[0][1]+(d[1][1]-d[0][1])*m,g=d[0][2]+(d[1][2]-d[0][2])*m,b=(a=d[0][3],o=d[1][3],s=void 0,a+(2*(s=(o-a)%Gt)%Gt-s)*m);if(l.type===i){var k=Math.pow(v.position.x-y,2)+Math.pow(v.position.y-g,2),x=N[l.itemId];k>1?l.animationState!==x.anim.use&&x.anim.move!==l.animationState&&l.changeAnimState(x.anim.move):l.animationState!==x.anim.use&&x.anim.idle!==l.animationState&&l.changeAnimState(x.anim.idle)}l.setTransform(y,g,b)}}l.doUpdate&&l.update(e)}if(-1!==Ci&&Wi.has(Ci)){var A=Wi.find(Ci),S=A.root;Di.position.x=.5*Mi.scaledWidth-S.position.x,Di.position.y=.5*Mi.scaledHeight-S.position.y,A.setRotation(Z)}}function qi(t){var e=It.readU8(),a=It.readULEB128(),o=It.readF32(),s=function(t,e,a,o,s,h){var c;switch(a){case i:c=new si(a);break;case r:c=new ui(a);break;case n:c=new Li(a);break;default:c=new at(a)}return c.type=a,c.id=e,c.buffer.push(nt(t,o,s,h)),c.root.setDepth(a),c.setTransform(o,s,h),c.addToScene(),Wi.insert(c),c}(t,a,e,It.readF32(),It.readF32(),o);if(console.log("+",a),s.type===i){var h=It.readU16();s.nameLabel.updateText(Oi.get(h));var c=It.readU16();c!==s.itemId&&(s.itemId=c,s.changeItem(c))}}function Gi(){var t=It.readULEB128();console.log("-",t),function(t){var e=Wi.find(t);Wi.deleteId(t),e.removeFromScene()}(t)}function Ji(){var t=It.readU8();Ki=t,console.log("tickRate, ",t)}function Qi(){var t=It.readULEB128();Ci=t,console.log("[Client] got our eid: "+t)}function Vi(){var t=It.readULEB128(),e=It.readString();Oi.set(t,e),console.log("[Client] new client joined! ".concat(t," ").concat(e))}function Zi(){var t=It.readULEB128(),e=It.readU16(),i=Wi.find(t);e!==i.itemId&&(i.itemId=e,i.changeItem(e))}function $i(){var t=It.readULEB128(),e=It.readU8();Wi.find(t).changeAnimState(e)}function tn(){var t=It.readULEB128(),e=It.readF32(),i=Wi.find(t),n=40*Math.cos(e),r=40*Math.sin(e);i.setHit(n,r)}function en(){var t=It.readU8();console.log("Inventory");for(var e=0;e<t;e++){var i=It.readU16(),n=It.readU16();console.log(i,n)}}function nn(){var t=It.readULEB128(),e=It.readU16();Wi.find(t).updateHealth(e)}Fi.add(Di),Fi.add(ji),Fi.add(_i),function(){var t=new wt(qt[x]);zi.add(t);var e=new gt("Hello world!",{align:"left",baseLine:"top",fill:"red",fontFamily:"Ariel",fontSize:100});_i.add(ki),_i.add(Ti),zi.add(e),Xi()}();var rn=Date.now();Ni(),window.addEventListener("resize",Ni),function t(){var e=Date.now(),i=(e-rn)/1e3;rn=e,Yi(e,i),Mi.clearScreen("#8ab842"),Mi.render(Fi),Bi.rotation-=.1,window.requestAnimationFrame(t)}()})();